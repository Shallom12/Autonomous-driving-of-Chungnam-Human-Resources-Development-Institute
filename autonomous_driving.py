# -*- coding: utf-8 -*-
"""autonomous_driving.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1TY1EKGg0AmrfGJlLLlmMk3kh2hPMgjO3
"""

#this is a commet
print('hello world')

x = 12
y = 'jeongjueun'
print(x)
print(y)
print(str(x)+y)

if 5 > 2:
  print('Five is greater than two')
x = 4
x = 'Daniel'
print(x)

x = str(3)
y = int(5)
z = float(7)
print(type(x))
print(type(y))
my_var_name = 'John'

x, y, z= 'Orange', 'Banana', 'Cherry'
print(x)
print(y)
print(z)

"""#python variables"""

x = y = z = 'Orange'
print(x)
print(y)
print(x)

fruits = ['apple','banana', 'cherry']
x, y, z = fruits
print(x)
print(y)
print(z)

x = 'python'
y = 'is'
z = 'awesome'
print(x,y,z)
print(x+y+z)

x = 5
y = 15
print(x+y)

x = 'awesome'
def myfunc():
  print('python is' + x)
myfunc()
print('python is' + x)

"""### 1. ë™ì˜ìƒ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° ë˜ëŠ” ì›¹ìº  ì—°ê²° (0ë²ˆì€ ê¸°ë³¸ ì¹´ë©”ë¼)
### 2. ì´ë¯¸ì§€ë¥¼ ê·¸ë ˆì´ìŠ¤ì¼€ì¼ë¡œ ë³€í™˜ (ìƒ‰ ì •ë³´ ì œê±°, ì—°ì‚° ë¹ ë¥´ê²Œ í•˜ê¸° ìœ„í•¨)
### 3. ê°€ìš°ì‹œì•ˆ ë¸”ëŸ¬ ì ìš© (ë…¸ì´ì¦ˆ ì œê±°)
### 4. Canny ì—£ì§€ ê²€ì¶œ (ê²½ê³„ì„  ì°¾ê¸°)
### 5. ê´€ì‹¬ì˜ì—­(ROI) ì„¤ì • - ì‚¼ê°í˜• ì˜ì—­ë§Œ ì¶”ì¶œ (ì°¨ì„ ì´ ìœ„ì¹˜í•  êµ¬ê°„ë§Œ ì§‘ì¤‘)
### 6. í—ˆí”„ ë³€í™˜ìœ¼ë¡œ ì§ì„  ê²€ì¶œ
### 7. ê²€ì¶œëœ ì§ì„ ì„ ì›ë³¸ ì´ë¯¸ì§€ì— ê·¸ë¦¬ê¸°
### 8. ì›ë³¸ í”„ë ˆì„ê³¼ ì§ì„  ì´ë¯¸ì§€ í•©ì„±
### 9. ê²°ê³¼ ì¶œë ¥
### 10. q í‚¤ë¥¼ ëˆ„ë¥´ë©´ ì¢…ë£Œ
"""

import cv2
import numpy as np

# 1. ë™ì˜ìƒ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° ë˜ëŠ” ì›¹ìº  ì—°ê²° (0ë²ˆì€ ê¸°ë³¸ ì¹´ë©”ë¼)
cap = cv2.VideoCapture("lane_video.mp4")  # ë˜ëŠ” cap = cv2.VideoCapture(0)

while cap.isOpened():
    ret, frame = cap.read()  # í•œ í”„ë ˆì„ì”© ì½ì–´ì˜´
    if not ret:
        break

    # 2. ì´ë¯¸ì§€ë¥¼ ê·¸ë ˆì´ìŠ¤ì¼€ì¼ë¡œ ë³€í™˜ (ìƒ‰ ì •ë³´ ì œê±°, ì—°ì‚° ë¹ ë¥´ê²Œ í•˜ê¸° ìœ„í•¨)
    gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)

    # 3. ê°€ìš°ì‹œì•ˆ ë¸”ëŸ¬ ì ìš© (ë…¸ì´ì¦ˆ ì œê±°)
    blur = cv2.GaussianBlur(gray, (5, 5), 0)

    # 4. Canny ì—£ì§€ ê²€ì¶œ (ê²½ê³„ì„  ì°¾ê¸°)
    edges = cv2.Canny(blur, 50, 150)

    # 5. ê´€ì‹¬ì˜ì—­(ROI) ì„¤ì • - ì‚¼ê°í˜• ì˜ì—­ë§Œ ì¶”ì¶œ (ì°¨ì„ ì´ ìœ„ì¹˜í•  êµ¬ê°„ë§Œ ì§‘ì¤‘)
    height = frame.shape[0]
    polygon = np.array([[
        (0, height),
        (frame.shape[1], height),
        (frame.shape[1]//2, height//2)
    ]])
    mask = np.zeros_like(edges)
    cv2.fillPoly(mask, polygon, 255)
    cropped_edges = cv2.bitwise_and(edges, mask)

    # 6. í—ˆí”„ ë³€í™˜ìœ¼ë¡œ ì§ì„  ê²€ì¶œ
    lines = cv2.HoughLinesP(
        cropped_edges,
        rho=1,
        theta=np.pi / 180,
        threshold=50,
        minLineLength=50,
        maxLineGap=150
    )

    # 7. ê²€ì¶œëœ ì§ì„ ì„ ì›ë³¸ ì´ë¯¸ì§€ì— ê·¸ë¦¬ê¸°
    line_image = np.zeros_like(frame)
    if lines is not None:
        for line in lines:
            x1, y1, x2, y2 = line[0]
            cv2.line(line_image, (x1, y1), (x2, y2), (0, 255, 0), 5)

    # 8. ì›ë³¸ í”„ë ˆì„ê³¼ ì§ì„  ì´ë¯¸ì§€ í•©ì„±
    combined = cv2.addWeighted(frame, 0.8, line_image, 1, 1)

    # 9. ê²°ê³¼ ì¶œë ¥
    cv2.imshow("Lane Detection", combined)

    # 10. q í‚¤ë¥¼ ëˆ„ë¥´ë©´ ì¢…ë£Œ
    if cv2.waitKey(1) & 0xFF == ord('q'):
        break

# ë¦¬ì†ŒìŠ¤ í•´ì œ
cap.release()
cv2.destroyAllWindows()

"""# ğŸ¯ YOLOv5ë¡œ ê°ì²´ íƒì§€

Ultralyticsì—ì„œ ì œê³µí•˜ëŠ” `yolov5` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•´, ìƒ˜í”Œ ì´ë¯¸ì§€ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì‹¤ì‹œê°„ ê°ì²´ ì¸ì‹ì„ ì‹¤í–‰í•´ë´…ë‹ˆë‹¤.

- **ë¼ì´ë¸ŒëŸ¬ë¦¬**: yolov5 (PyTorch ê¸°ë°˜)
- **ìƒ˜í”Œ ì´ë¯¸ì§€**: Zidane ì¶•êµ¬ê²½ê¸° ì‚¬ì§„

"""

# 1ï¸âƒ£ yolov5 ì„¤ì¹˜
!pip install yolov5 -q  # ultralytics íŒ¨í‚¤ì§€ê°€ í•¨ê»˜ ì„¤ì¹˜ë©ë‹ˆë‹¤.

# 2ï¸âƒ£ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„í¬íŠ¸ & ëª¨ë¸ ë¡œë“œ
from yolov5 import YOLOv5
import cv2
import matplotlib.pyplot as plt

# Colab ëŸ°íƒ€ì„ì— ë§ì¶° device ì„ íƒ (cpu/gpu ìë™)
model = YOLOv5("yolov5s.pt", device="")  # ê°€ë³ê³  ë¹ ë¥¸ yolov5s ë²„ì „

# 3ï¸âƒ£ ìƒ˜í”Œ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
!wget -q https://ultralytics.com/images/zidane.jpg -O sample.jpg
img = cv2.imread("sample.jpg")[:, :, ::-1]  # BGRâ†’RGB

# 4ï¸âƒ£ ì¶”ë¡  ìˆ˜í–‰
results = model.predict(img)

# 5ï¸âƒ£ ê²°ê³¼ ì‹œê°í™”
annotated = results.render()[0]  # Annotated image
plt.figure(figsize=(8,5))
plt.imshow(annotated)
plt.axis("off")

